<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />

  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff7fb" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0e0a14" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Reflections" />

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Reflections âœ¨</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- iOS install icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&family=Comfortaa:wght@500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Patrick+Hand&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="overrides.css" />
</head>
<body>
  <!-- Clean 1s loading â€” a single âœ¨ gliding across the screen -->
  <div id="loadingScreen" class="loading-screen" aria-hidden="true">
    <span class="sparkle-mover" role="img" aria-label="Loading">âœ¨</span>
  </div>

  <!-- Dreamy background -->
  <div class="aurora">
    <span class="blob b1"></span>
    <span class="blob b2"></span>
    <span class="blob b3"></span>
    <span class="stars"></span>
    <span class="sprinkles s1"></span>
    <span class="sprinkles s2"></span>
  </div>

  <main class="container">
    <nav class="tabs glass">
      <button class="tab active" data-tab="compose" aria-controls="composePanel">ğŸ’Œ Compose</button>
      <button class="tab" data-tab="inbox" aria-controls="inboxPanel">ğŸ“š Library</button>
    </nav>

    <section id="composePanel" class="panel active">
      <div class="card paper">
        <div class="paper-tape t1" aria-hidden="true"></div>
        <div class="paper-tape t2" aria-hidden="true"></div>

        <h2 id="greetingTitle">Welcome âœ¨</h2>
        <div id="streakWrap" class="streak-wrap" aria-live="polite">
          <span id="streakChip" class="streak-chip" hidden>ğŸ”¥ 0-day streak</span>
        </div>

        <label class="field">
          <span>Title</span>
          <input id="mailTitle" type="text" placeholder="A tiny sparkle of thought..." maxlength="120" />
        </label>
        <label class="field">
          <span>Body</span>
          <textarea id="mailBody" rows="10" class="diary-text" placeholder="Pour your heart out with glitter and grace..."></textarea>
        </label>

        <div class="field">
          <span>Photos</span>
          <div class="image-controls">
            <button id="addPhotosBtn" class="btn">Add photos</button>
            <button id="clearPhotosBtn" class="btn ghost small">Clear photos</button>
            <input id="imageInput" type="file" accept="image/*" multiple hidden />
          </div>
          <div id="imagePreview" class="image-previews" aria-live="polite"></div>
          <p class="hint">You can select multiple images; theyâ€™ll be compressed before upload.</p>
        </div>

        <div class="actions">
          <button id="sendBtn" class="btn primary">Send to future ğŸš€</button>
          <button id="clearBtn" class="btn ghost">Clear</button>
        </div>
        <p id="composeHint" class="hint">Your note travels to your secret constellation (a JSON file in your GitHub repo) when you press send.</p>
        <div class="under-hint">
          <button id="settingsBtn" class="icon-chip" aria-label="Open settings">âš™ï¸ Settings</button>
        </div>
        <p id="composeStatus" class="status"></p>
      </div>
    </section>

    <section id="inboxPanel" class="panel">
      <div class="inbox-controls">
        <div class="left-controls">
          <button id="toggleCalendarBtn" class="btn small" aria-expanded="false" aria-controls="calendarDropdown">ğŸ“… Calendar</button>
          <button id="clearFilterBtn" class="btn small ghost" hidden>Clear date filter</button>
          <span id="activeFilterChip" class="chip" hidden>
            <span class="chip-text"></span>
            <button id="chipClearBtn" class="chip-x" aria-label="Clear date filter">Ã—</button>
          </span>
        </div>
        <div class="right-controls">
          <button id="refreshBtn" class="btn small">Refresh âœ¨</button>
          <span id="inboxStatus" class="status"></span>
        </div>
      </div>

      <!-- Calendar Dropdown Panel -->
      <div id="calendarDropdown" class="dropdown-panel glass" role="dialog" aria-modal="false" aria-labelledby="calTitle" hidden>
        <div class="cal-header">
          <div class="nav">
            <button id="calPrev" class="icon-btn" aria-label="Previous month">â—€</button>
            <button id="calToday" class="btn small ghost">Today</button>
            <button id="calNext" class="icon-btn" aria-label="Next month">â–¶</button>
          </div>
          <div class="cal-title-wrap">
            <div id="calTitle" class="cal-title" aria-live="polite">Month YYYY</div>
            <div class="cal-pickers">
              <select id="monthSelect" aria-label="Select month"></select>
              <select id="yearSelect" aria-label="Select year"></select>
            </div>
          </div>
        </div>
        <div class="cal-grid" id="calendarGrid" role="grid" aria-label="Calendar"></div>
        <div class="cal-legend">
          <span class="dot has-entry"></span> has entry
          <span class="dot today"></span> today
          <span class="dot selected"></span> filtered date
        </div>
      </div>

      <div id="inboxGrid" class="masonry"></div>
      <template id="cardTemplate">
        <article class="note-card paper card">
          <img class="note-thumb" alt="" hidden loading="lazy" />
          <h3 class="note-title"></h3>
          <p class="note-preview diary-text"></p>
          <div class="note-meta">
            <span class="date"></span>
            <button class="read-btn">Open</button>
          </div>
        </article>
      </template>
    </section>
  </main>

  <!-- Reader modal -->
  <dialog id="readerModal" class="modal glass">
    <div class="modal-header sticky">
      <h3 id="readerTitle">Title</h3>
      <button id="closeReader" class="icon-btn modal-close" aria-label="Close" title="Close">Ã—</button>
    </div>
    <article id="readerBody" class="reader-body diary-text"></article>
    <div id="readerGallery" class="gallery"></div>
    <div class="modal-footer">
      <button id="deleteBtn" class="btn danger">Delete</button>
      <button id="shareBtn" class="btn">Share</button>
    </div>
  </dialog>

  <!-- Token and settings -->
  <dialog id="tokenModal" class="modal glass sm">
    <form method="dialog" id="tokenForm" class="token-form">
      <div class="modal-header">
        <h3>Welcome to Reflections âœ¨</h3>
        <button type="button" class="icon-btn modal-close" aria-label="Close" id="closeToken" title="Close">Ã—</button>
      </div>
      <div class="modal-body">
        <p class="soft">To let your letters float among the stars, whisper your name and Magic Key (GitHub token) below.</p>
        <label class="field">
          <span>Your Name</span>
          <input id="nameInput" type="text" placeholder="e.g., Sakshi" autocomplete="off" />
        </label>
        <label class="field">
          <span>Magic Key</span>
          <input id="tokenInput" type="password" placeholder="ghp_..." autocomplete="off" />
        </label>
        <details class="gentle">
          <summary>How to conjure a Magic Key</summary>
          <ol class="steps">
            <li>GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Fineâ€‘grained tokens.</li>
            <li>Select your repo; grant Repository â†’ Contents: Read and write.</li>
            <li>Copy the token (ghp_ / github_pat_â€¦). Keep it secret.</li>
          </ol>
        </details>
      </div>
      <div class="modal-footer">
        <button class="btn primary" id="saveTokenBtn">Begin the magic âœ¨</button>
      </div>
      <p class="hint modal-hint">Your name and Magic Key are saved only on this device. You can remove them anytime in Settings.</p>
    </form>
  </dialog>

  <dialog id="settingsModal" class="modal glass sm">
    <div class="modal-header">
      <h3>Magic Key âœ¨</h3>
      <button id="closeSettings" class="icon-btn modal-close" aria-label="Close" title="Close">Ã—</button>
    </div>
    <div class="settings-body modal-body">
      <p class="soft">Manage your secret Magic Key (GitHub token) here.</p>
      <div class="sep"></div>
      <div class="grid2">
        <button id="reenterTokenBtn" class="btn">Re-enter Magic Key / Name</button>
        <button id="forgetTokenBtn" class="btn danger">Forget Magic Key</button>
      </div>
      <p class="hint">Your secret lives only on this device. Re-enter or forget it anytime.</p>
    </div>
  </dialog>

  <dialog id="updateModal" class="modal glass sm">
    <div class="modal-header">
      <h3>Fresh Starlight Awaits âœ¨</h3>
      <button id="closeUpdate" class="icon-btn modal-close" aria-label="Close" title="Close">Ã—</button>
    </div>
    <article class="reader-body modal-body">
      <p>A new sprinkle of Reflections magic is ready. Update now or later?</p>
    </article>
    <div class="modal-footer">
      <button id="updateLaterBtn" class="btn ghost">Later</button>
      <button id="updateNowBtn" class="btn primary">Update now âœ¨</button>
    </div>
  </dialog>

  <!-- Footer -->
  <footer class="app-footer">
    <button id="creditLink" class="flip" aria-label="Credits" aria-pressed="false" aria-expanded="false">
      <span class="flip-inner">
        <span class="front">&lt;/&gt; with ğŸª„ by Spandan.</span>
        <span class="back">An SÂ² Labs Product</span>
      </span>
    </button>
  </footer>

  <script src="app.js" type="module"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => document.getElementById('loadingScreen')?.classList.add('hide'), 1000);
    });
  </script>
</body>
</html>