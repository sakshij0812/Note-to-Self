<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aurora Inbox</title>
  <meta name="theme-color" content="#ffbce1" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icons/icon.svg">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Global aurora canvas -->
  <div class="sky" aria-hidden="true">
    <div class="glow a"></div>
    <div class="glow b"></div>
    <div class="glow c"></div>
    <div class="glow d"></div>
  </div>

  <!-- Header -->
  <header class="bar">
    <div class="brand">
      <div class="emblem">âœ¿</div>
      <div class="title">
        <h1>Aurora Inbox</h1>
        <p>Sweet notes for future you</p>
      </div>
    </div>

    <div class="indicators">
      <span id="repoBadge" class="pill"></span>
      <span id="connDot" class="dot" title="Sync status"></span>
      <button id="changeToken" class="icon-btn" aria-label="Change token">ðŸ”‘</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="tabs" role="tablist" aria-label="Primary">
    <button id="composeTab" class="tab active" role="tab" aria-selected="true" aria-controls="composePanel">
      <span>Compose</span>
    </button>
    <button id="inboxTab" class="tab" role="tab" aria-selected="false" aria-controls="inboxPanel">
      <span>Inbox</span>
    </button>
  </nav>

  <!-- Content -->
  <main class="wrap">
    <!-- Compose -->
    <section id="composePanel" class="panel active" role="tabpanel" aria-labelledby="composeTab">
      <article class="glass card">
        <header class="card-head">
          <h2>Write a tiny spell</h2>
        </header>

        <form id="composeForm" class="form">
          <label class="field">
            <span class="label">Title</span>
            <input id="title" name="title" type="text" required maxlength="120" placeholder="Starlight reminderâ€¦" />
          </label>

          <label class="field">
            <span class="label">Message</span>
            <textarea id="body" name="body" rows="8" required placeholder="Whisper to future-youâ€¦"></textarea>
          </label>

          <!-- Desktop/tablet actions -->
          <div class="actions desktop-only">
            <button type="submit" class="btn rainbow">Send to myself</button>
            <button type="button" id="clearForm" class="btn ghost">Clear</button>
          </div>

          <p class="hint">Private to your device. When a secret key is set, notes sync to your GitHub vault.</p>
        </form>
      </article>
    </section>

    <!-- Inbox -->
    <section id="inboxPanel" class="panel" role="tabpanel" aria-labelledby="inboxTab">
      <article class="glass card">
        <header class="card-head row">
          <h2>Your constellations</h2>
          <div class="desktop-only">
            <button id="refreshInbox" class="btn small">Refresh</button>
            <button id="exportJson" class="btn small ghost">Export JSON</button>
          </div>
        </header>

        <div id="emptyState" class="empty">
          <p>No notes yet. Cast your first âœ¨ on the Compose tab.</p>
        </div>

        <div id="inboxList" class="masonry" role="list"></div>
      </article>
    </section>
  </main>

  <!-- Mobile sticky action bars -->
  <div id="composeActionBar" class="action-bar" data-for="compose">
    <button id="sendMobile" class="btn rainbow">Send</button>
    <button id="clearMobile" class="btn ghost">Clear</button>
  </div>
  <div id="inboxActionBar" class="action-bar" data-for="inbox">
    <button id="refreshMobile" class="btn rainbow">Refresh</button>
    <button id="exportMobile" class="btn ghost">Export</button>
  </div>

  <!-- Floating token FAB on mobile -->
  <button id="keyFab" class="fab" aria-label="Set GitHub token">ðŸ”‘</button>

  <!-- Magical token sheet -->
  <dialog id="tokenDialog" class="sheet" aria-labelledby="tokenTitle">
    <form id="tokenForm" method="dialog" class="sheet-body">
      <div class="sheet-aurora"></div>
      <div class="sheet-content">
        <div class="stars">âœ¦ âœ§ âœ¦</div>
        <h2 id="tokenTitle">Unlock your stardust vault</h2>
        <p class="sub">Paste your secret so Aurora can tuck notes into your GitHub galaxy. It never leaves this device.</p>

        <label class="field">
          <span class="label">Secret key</span>
          <div class="token">
            <input id="tokenInput" type="password" inputmode="text" autocomplete="off" placeholder="ghp_â€¦ or github_pat_â€¦" required />
            <div class="row gap">
              <button type="button" id="pasteToken" class="chip">Paste</button>
              <button type="button" id="toggleToken" class="chip">Reveal</button>
            </div>
          </div>
        </label>

        <p class="hint center">Tip: fineâ€‘grained token â†’ Contents: Read & Write for only this repo.</p>

        <div class="sheet-actions">
          <button id="saveToken" class="btn rainbow" value="save">Save secret</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- Update banner -->
  <div id="updateBanner" class="update" hidden>
    <span class="update-text">A new Aurora is shimmering âœ¨</span>
    <div class="row gap">
      <button id="updateNow" class="btn small rainbow">Update</button>
      <button id="updateLater" class="btn small ghost">Later</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="foot" role="contentinfo">
    <button id="footerFlip" class="flip" aria-pressed="false" aria-label="Toggle footer message">
      <span class="flip-inner">
        <span class="face front">
          <span class="tag">&lt;/&gt;</span>
          <span class="with">with ðŸª„ by</span>
          <img class="sig" src="icons/spandan-signature.png" alt="Spandan" />
        </span>
        <span class="face back" aria-hidden="true">An SÂ² Labs Product</span>
      </span>
    </button>
  </footer>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script type="module" src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(console.warn);
      });
    }
  </script>
</body>
</html>